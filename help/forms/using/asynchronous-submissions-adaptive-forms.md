---
title: アダプティブフォームの非同期送信
seo-title: Asynchronous submission of adaptive forms
description: ここでは、アダプティブフォームの非同期送信を設定する方法について説明します。
seo-description: Learn to configure asynchronous submission for adaptive forms.
uuid: 3b8aeac8-cb38-4a2b-8375-556b2736d58b
contentOwner: vishgupt
products: SG_EXPERIENCEMANAGER/6.4/FORMS
topic-tags: develop
discoiquuid: 6e4e3af5-4260-4f38-9b29-0818e92bc182
feature: Adaptive Forms
exl-id: 1ca492e9-9832-4e5d-8020-2690ac4f5505
source-git-commit: bd94d3949f0117aa3e1c9f0e84f7293a5d6b03b4
workflow-type: tm+mt
source-wordcount: '655'
ht-degree: 100%

---

# アダプティブフォームの非同期送信 {#asynchronous-submission-of-adaptive-forms}

これまでの Web フォームは、同期送信用に設定されていました。ユーザーはフォームを送信すると、確認ページにリダイレクトされます。送信時にエラーが発生した場合は、エラーページにリダイレクトされます。しかし、現在では、単一ページアプリケーションなどの最新の Web エクスペリエンスが広く使用されるようになっています。こうしたアプリケーションでは、バックグラウンドでクライアントとサーバー間の通信が実行されている間は、Web ページが静的な状態のままになります。非同期送信を設定することにより、アダプティブフォームでこうした Web エクスペリエンスを実現することができます。この場合、送信されたフォームデータがサーバー上で検証される際に、フォームが再読み込みされたり、フォームの URL が変更されたりすることがないため、アダプティブフォームが単一ページアプリケーションと同じように動作します。

ここからは、アダプティブフォームの非同期送信について詳しく説明します。

## 非同期送信の設定 {#configure}

アダプティブフォームの非同期送信を設定するには、以下の手順を実行します。

1. アダプティブフォームのオーサリングモードで、フォームコンテナオブジェクトを選択し、![cmppr1](assets/cmppr1.png) をタップしてプロパティを開きます。
1. 「**[!UICONTROL 送信]**」プロパティセクションで、「**[!UICONTROL 非同期送信を使用]**」を有効にします。
1. 「**[!UICONTROL 送信時]**」セクションで、フォームが正常に送信された場合に実行するオプションを以下のどちらかから選択します。

   * **[!UICONTROL URL にリダイレクト]**：フォームの送信時に、指定の URL またはページにリダイレクトされます。「**[!UICONTROL リダイレクト URL / パス]**」フィールドで URL を指定することも、ページのパスを参照して選択することもできます。
   * **[!UICONTROL メッセージを表示]**：フォームの送信時にメッセージを表示します。「メッセージを表示」オプションの下のテキストフィールドにメッセージを入力できます。このテキストフィールドは、リッチテキスト形式をサポートします。

1. ![check-button1](assets/check-button1.png) をタップしてプロパティを保存します。

## 非同期送信の仕組み {#how-asynchronous-submission-works}

AEM Forms には、フォーム送信が成功した場合と失敗した場合の処理を実行するハンドラーが用意されています。これらのハンドラーは、すぐに使用することができます。ハンドラーは、サーバー応答に基づいて実行されるクライアントサイド関数です。フォームが送信されると、データが検証のためにサーバーに転送され、送信の成功またはエラーイベントに関する情報と共に、応答がクライアントに返されます。この情報は、関連するハンドラーにパラメーターとして渡され、関数が実行されます。

また、フォームの作成者と開発者は、フォームレベルでルールを記述して、デフォルトのハンドラーを上書きできます。詳しくは、「[ルールを使用したデフォルトハンドラーの上書き](#custom)」を参照してください。

最初に、成功およびエラーイベントに対するサーバー応答について説明します。

### 送信成功イベントに対するサーバー応答 {#server-response-for-submission-success-event}

送信成功イベントに対するサーバー応答は、以下のような構造になっています。

```
{
  contentType : "<xmlschema or jsonschema>", 
  data : "<dataXML or dataJson>" , 
  thankYouOption : <page/message>, 
  thankYouContent : "<thank you page url/thank you message>"
}
```

フォーム送信が成功した場合に含まれるサーバー応答を以下に示します。

* フォームデータのフォーマットタイプ：XML または JSON
* XML 形式または JSON 形式のフォームデータ
* フォームに設定された、ページにリダイレクトするかメッセージを表示するために選択されたオプション
* フォームに設定された、ページの URL またはメッセージの内容

成功ハンドラーは、サーバー応答を読み取り、それに応じて、設定されたページ URL にリダイレクトしたりメッセージを表示したりします。

### 送信エラーイベントに対するサーバー応答 {#server-response-for-submission-error-event}

送信エラーイベントに対するサーバー応答は、以下のような構造になっています。

```
{
   errorCausedBy : "<CAPTCHA_VALIDATION or SERVER_SIDE_VALIDATION>",

   errors : [
               { "somExpression" : "<SOM Expression>",
                 "errorMessage"  : "<Error Message>"
               },
               ...
             ]
 }
```

フォーム送信がエラーになった場合に含まれるサーバー応答を以下に示します。

* エラーの理由、失敗した CAPTCHA またはサーバーサイド検証
* 検証が失敗したフィールドの SOM 式と、対応するエラーメッセージを含む、エラーオブジェクトのリスト

エラーハンドラーは、サーバー応答を読み取り、それに応じて、フォーム上にエラーメッセージを表示します。

## ルールを使用したデフォルトハンドラーの上書き {#custom}

フォームの開発者と作成者は、コードエディターを使用してフォームレベルでルールを記述することにより、デフォルトのハンドラーを上書きすることができます。成功イベントおよびエラーイベントに対するサーバー応答は、フォームレベルで公開されます。開発者は、ルール内で `$event.data` を使用してサーバー応答にアクセスできます。

成功イベントとエラーイベントを処理するためのルールをコードエディターで記述するには、以下の手順を実行します。

1. アダプティブフォームをオーサリングモードで開いて、任意のフォームオブジェクトを選択し、![edit-rules1](assets/edit-rules1.png) をタップしてルールエディターを開きます。
1. フォームオブジェクトツリーで「**[!UICONTROL フォーム]**」選択し、「**[!UICONTROL 作成]**」をタップします。
1. モード選択ドロップダウンで「**[!UICONTROL コードエディター]**」を選択します。
1. コードエディターで「**[!UICONTROL コードを編集]**」をタップします。確認ダイアログで「**[!UICONTROL 編集]**」をタップします。
1. 「**[!UICONTROL イベント]**」ドロップダウンで、「**[!UICONTROL 送信成功]**」または「**[!UICONTROL 送信中のエラー]**」を選択します。
1. 選択したイベントのルールを記述し、「**[!UICONTROL 完了]**」をタップしてルールを保存します。
